

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>地図を生成するGazebo Pluginを作る &mdash; Dronedoc 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://uenota.github.io/dronedoc/build_map_gazebo_plugin/gazebo_map_builder.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Dronedoc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">SLAM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../px4sim/px4sim.html">PX4 SITL Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runnode/runnodecpp.html">自作ノードを実行する（C++）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runnode/runnodepy.html">自作ノードを実行する（Python）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addmodel/addmodel.html">新しいモデルを追加する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/slam.html">自律飛行とSLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/gps_nav.html">GPSを用いた自律飛行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/turtle_mapping.html">Turtlebotを使ってマップを作る</a></li>
<li class="toctree-l1"><a class="reference internal" href="../teleop/teleop.html">ゲームパッドを使ってドローンを操作する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/lidar_localization.html">LiDARとAMCLを用いた自己位置推定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/localization_and_mapping.html">LiDARを用いたSLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/lidar_nav.html">LiDARを用いた自律移動</a></li>
</ul>
<p class="caption"><span class="caption-text">Mapping</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../octomap/octomap.html">Octomapを使って3Dマップを作る</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_map_gmapping/build_map_gmapping.html">Gmappingを使って地図を生成する</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_map_gazebo_plugin.html">Gazebo Pluginを使って地図を作成する</a></li>
</ul>
<p class="caption"><span class="caption-text">Motion Planning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moveit/index.html">Perform motion planning of UAV with MoveIt!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../local_planner_for_uav/local_planner_for_uav.html">UAV用のローカルプランナを実装する</a></li>
</ul>
<p class="caption"><span class="caption-text">Tips</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qgc_intro/qgc_intro.html">QGroundControl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add_range_sensor/add_range_sensor.html">ドローンに距離センサを搭載する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filter_lidar/filter_lidar.html">LiDARのデータをフィルタリングする</a></li>
<li class="toctree-l1"><a class="reference internal" href="../change_local_planner/change_local_planner.html">move_baseのローカルプランナーを変更する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../airsim/airsim.html">AirSimシミュレータを使う</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/bash_commands/bash_commands.html">基本的なBashの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/ros/ros.html">ROSの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/terms/terms.html">用語集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/archive/archive.html">読書案内</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/trouble_shooting/index.html">トラブルシューティング</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dronedoc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>地図を生成するGazebo Pluginを作る</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/build_map_gazebo_plugin/gazebo_map_builder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gazebo-plugin">
<h1>地図を生成するGazebo Pluginを作る<a class="headerlink" href="#gazebo-plugin" title="Permalink to this headline">¶</a></h1>
<p>以下のコード以外は <a class="reference external" href="http://gazebosim.org/tutorials?cat=install&amp;tut=custom_messages&amp;ver=1.9-7">Custom messages</a> にあるものと同じです。</p>
<div class="section" id="map-builder-cpp">
<h2>map_builder.cpp<a class="headerlink" href="#map-builder-cpp" title="Permalink to this headline">¶</a></h2>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">map_builder.cpp</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;boost/gil/gil_all.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;boost/gil/extension/io/png_dynamic_io.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;boost/shared_ptr.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sdf/sdf.hh&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;gazebo/gazebo.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/common/common.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/math/Vector3.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/msgs/msgs.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/physics/physics.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/transport/transport.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;map_request.pb.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;yaml-cpp/yaml.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;boost/filesystem.hpp&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">gazebo</span>
<span class="p">{</span>
<span class="k">typedef</span> <span class="k">const</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">dronedoc</span><span class="o">::</span><span class="n">msgs</span><span class="o">::</span><span class="n">MapRequest</span><span class="o">&gt;</span> <span class="n">MapRequestPtr</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MapCreator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">WorldPlugin</span>
<span class="p">{</span>
  <span class="n">transport</span><span class="o">::</span><span class="n">NodePtr</span> <span class="n">node</span><span class="p">;</span>
  <span class="n">transport</span><span class="o">::</span><span class="n">PublisherPtr</span> <span class="n">imagePub</span><span class="p">;</span>
  <span class="n">transport</span><span class="o">::</span><span class="n">SubscriberPtr</span> <span class="n">commandSubscriber</span><span class="p">;</span>
  <span class="n">physics</span><span class="o">::</span><span class="n">WorldPtr</span> <span class="n">world</span><span class="p">;</span>

  <span class="k">public</span><span class="o">:</span> <span class="kt">void</span> <span class="n">Load</span><span class="p">(</span><span class="n">physics</span><span class="o">::</span><span class="n">WorldPtr</span> <span class="n">_parent</span><span class="p">,</span> <span class="n">sdf</span><span class="o">::</span><span class="n">ElementPtr</span> <span class="n">_sdf</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">transport</span><span class="o">::</span><span class="n">NodePtr</span><span class="p">(</span><span class="k">new</span> <span class="n">transport</span><span class="o">::</span><span class="n">Node</span><span class="p">());</span>
    <span class="n">world</span> <span class="o">=</span> <span class="n">_parent</span><span class="p">;</span>
    <span class="c1">// Initialize the node with the world name</span>
    <span class="n">node</span><span class="o">-&gt;</span><span class="n">Init</span><span class="p">(</span><span class="n">world</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">());</span>
    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Subscribing to: ~/collision_map/command&quot;</span><span class="p">);</span>
    <span class="n">commandSubscriber</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">Subscribe</span><span class="p">(</span><span class="s">&quot;~/collision_map/command&quot;</span><span class="p">,</span>
      <span class="o">&amp;</span><span class="n">MapCreator</span><span class="o">::</span><span class="n">create</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="n">imagePub</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">Advertise</span><span class="o">&lt;</span><span class="n">msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;~/collision_map/image&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span><span class="o">:</span> <span class="kt">void</span> <span class="n">create</span><span class="p">(</span><span class="n">MapRequestPtr</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Received message&quot;</span><span class="p">);</span>

    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Creating collision map with origin at (%f, %f), width %f and height %f &quot;</span>
              <span class="s">&quot;with collision projected from z = %f</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot;Resolution = %f m</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot;Occupied spaces will be filled with: %d&quot;</span><span class="p">,</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">().</span><span class="n">x</span><span class="p">(),</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">().</span><span class="n">y</span><span class="p">(),</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">map_width</span><span class="p">(),</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">map_height</span><span class="p">(),</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">(),</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">resolution</span><span class="p">(),</span>
             <span class="n">msg</span><span class="o">-&gt;</span><span class="n">threshold</span><span class="p">());</span>

    <span class="kt">int</span> <span class="n">count_vertical</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">map_height</span><span class="p">()</span> <span class="o">/</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">resolution</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">count_horizontal</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">map_width</span><span class="p">()</span> <span class="o">/</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">resolution</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">count_vertical</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">count_horizontal</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot;Image has a zero dimensions, check coordinates&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>

    <span class="n">boost</span><span class="o">::</span><span class="n">gil</span><span class="o">::</span><span class="n">gray8_pixel_t</span> <span class="n">fill</span><span class="p">(</span><span class="mi">255</span><span class="o">-</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">threshold</span><span class="p">());</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">gil</span><span class="o">::</span><span class="n">gray8_pixel_t</span> <span class="n">blank</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">gil</span><span class="o">::</span><span class="n">gray8_image_t</span> <span class="n">image</span><span class="p">(</span><span class="n">count_horizontal</span><span class="p">,</span> <span class="n">count_vertical</span><span class="p">);</span>

    <span class="kt">double</span> <span class="n">dist</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">entityName</span><span class="p">;</span>
    <span class="n">math</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">;</span>
    <span class="n">start</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">();</span>
    <span class="n">end</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>

    <span class="n">gazebo</span><span class="o">::</span><span class="n">physics</span><span class="o">::</span><span class="n">PhysicsEnginePtr</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">world</span><span class="o">-&gt;</span><span class="n">GetPhysicsEngine</span><span class="p">();</span>
    <span class="n">engine</span><span class="o">-&gt;</span><span class="n">InitForThread</span><span class="p">();</span>
    <span class="n">gazebo</span><span class="o">::</span><span class="n">physics</span><span class="o">::</span><span class="n">RayShapePtr</span> <span class="n">ray</span> <span class="o">=</span>
      <span class="n">boost</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">gazebo</span><span class="o">::</span><span class="n">physics</span><span class="o">::</span><span class="n">RayShape</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">engine</span><span class="o">-&gt;</span><span class="n">CreateShape</span><span class="p">(</span><span class="s">&quot;ray&quot;</span><span class="p">,</span> <span class="n">gazebo</span><span class="o">::</span><span class="n">physics</span><span class="o">::</span><span class="n">CollisionPtr</span><span class="p">()));</span>

    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Rasterizing model and checking collisions&quot;</span><span class="p">);</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">gil</span><span class="o">::</span><span class="n">fill_pixels</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">_view</span><span class="p">,</span> <span class="n">blank</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count_vertical</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">progress</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">round</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">count_vertical</span><span class="p">)){</span>
        <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;%d%% complete&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">progress</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">round</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">count_vertical</span><span class="p">);</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">().</span><span class="n">x</span><span class="p">();</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">resolution</span><span class="p">()</span> <span class="o">+</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">().</span><span class="n">y</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">count_horizontal</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">resolution</span><span class="p">();</span>

        <span class="n">start</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">end</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">start</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">end</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="n">ray</span><span class="o">-&gt;</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
        <span class="n">ray</span><span class="o">-&gt;</span><span class="n">GetIntersection</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">entityName</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">entityName</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="p">{</span>
          <span class="n">image</span><span class="p">.</span><span class="n">_view</span><span class="p">(</span><span class="n">j</span><span class="p">,(</span><span class="n">count_vertical</span><span class="mi">-1</span><span class="p">)</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">fill</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">boost</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span> <span class="n">fname</span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">filename</span><span class="p">());</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">absolute</span><span class="p">(</span><span class="n">fname</span><span class="p">);</span>

    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Completed calculations, writing to image&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">filename</span><span class="p">().</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">boost</span><span class="o">::</span><span class="n">gil</span><span class="o">::</span><span class="n">gray8_view_t</span> <span class="n">view</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">_view</span><span class="p">;</span>
      <span class="n">boost</span><span class="o">::</span><span class="n">gil</span><span class="o">::</span><span class="n">png_write_view</span><span class="p">(</span><span class="n">fname</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">view</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Writing map info&quot;</span><span class="p">);</span>

    <span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span> <span class="n">out</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">BeginMap</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Key</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;image&quot;</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Value</span> <span class="o">&lt;&lt;</span> <span class="n">fname</span><span class="p">.</span><span class="n">filename</span><span class="p">().</span><span class="n">string</span><span class="p">();</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Key</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;resolution&quot;</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Value</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">resolution</span><span class="p">();</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Key</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;negate&quot;</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Value</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Key</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;free_thresh&quot;</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Value</span> <span class="o">&lt;&lt;</span> <span class="mf">0.196</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Key</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;occupied_thresh&quot;</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Value</span> <span class="o">&lt;&lt;</span> <span class="mf">0.65</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Key</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;origin&quot;</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Value</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Flow</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">BeginSeq</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">().</span><span class="n">x</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">().</span><span class="n">y</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mf">0.00</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">EndSeq</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">yaml_out</span><span class="p">(</span><span class="n">fname</span><span class="p">.</span><span class="n">replace_extension</span><span class="p">(</span><span class="s">&quot;.yaml&quot;</span><span class="p">).</span><span class="n">string</span><span class="p">());</span>
    <span class="n">yaml_out</span> <span class="o">&lt;&lt;</span> <span class="n">out</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
    <span class="n">yaml_out</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Map built successfully&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Register this plugin with the simulator</span>
<span class="n">GZ_REGISTER_WORLD_PLUGIN</span><span class="p">(</span><span class="n">MapCreator</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="request-publisher-cpp">
<h2>request_publisher.cpp<a class="headerlink" href="#request-publisher-cpp" title="Permalink to this headline">¶</a></h2>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">request_publisher.cpp</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;deque&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sdf/sdf.hh&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;gazebo/gazebo.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/common/common.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/math/Vector3.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/transport/transport.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/physics/physics.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;gazebo/msgs/msgs.hh&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;map_request.pb.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;vector2d.pb.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;boost/filesystem/path.hpp&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">bool</span> <span class="nf">createVector</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">vectorString</span><span class="p">,</span>
                       <span class="n">gazebo</span><span class="o">::</span><span class="n">msgs</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">*</span> <span class="n">origin</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">string</span> <span class="n">cornersStr</span> <span class="o">=</span> <span class="n">vectorString</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">opening</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">closing</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

    <span class="n">opening</span> <span class="o">=</span> <span class="n">cornersStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">&#39;(&#39;</span><span class="p">,</span> <span class="n">closing</span><span class="p">);</span>
    <span class="n">closing</span> <span class="o">=</span> <span class="n">cornersStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">&#39;)&#39;</span><span class="p">,</span> <span class="n">opening</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">opening</span> <span class="o">==</span> <span class="n">string</span><span class="o">::</span><span class="n">npos</span> <span class="o">||</span> <span class="n">closing</span> <span class="o">==</span> <span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot;Poorly formed string: %s&quot;</span><span class="p">,</span> <span class="n">cornersStr</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot;( found at: %ld ) found at: %ld&quot;</span><span class="p">,</span> <span class="n">opening</span><span class="p">,</span> <span class="n">closing</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">string</span> <span class="n">oneCornerStr</span> <span class="o">=</span> <span class="n">cornersStr</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">opening</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">closing</span> <span class="o">-</span> <span class="n">opening</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">size_t</span> <span class="n">commaLoc</span> <span class="o">=</span> <span class="n">oneCornerStr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">x</span> <span class="o">=</span> <span class="n">oneCornerStr</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">commaLoc</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">y</span> <span class="o">=</span> <span class="n">oneCornerStr</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">commaLoc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">oneCornerStr</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="n">commaLoc</span><span class="p">);</span>
    <span class="n">origin</span><span class="o">-&gt;</span><span class="n">set_x</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">()));</span>
    <span class="n">origin</span><span class="o">-&gt;</span><span class="n">set_y</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">c_str</span><span class="p">()));</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dronedoc</span><span class="o">::</span><span class="n">msgs</span><span class="o">::</span><span class="n">MapRequest</span> <span class="n">request</span><span class="p">;</span>
        <span class="n">gazebo</span><span class="o">::</span><span class="n">msgs</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">*</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">mutable_origin</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">createVector</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">origin</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot;Failed to create rasterize region.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="n">request</span><span class="p">.</span><span class="n">set_height</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
        <span class="n">request</span><span class="p">.</span><span class="n">set_resolution</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
        <span class="n">request</span><span class="p">.</span><span class="n">set_map_width</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]));</span>
        <span class="n">request</span><span class="p">.</span><span class="n">set_map_height</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]));</span>

        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">){</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;map.png&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span> <span class="n">fname</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">absolute</span><span class="p">(</span><span class="n">fname</span><span class="p">);</span>
        <span class="n">request</span><span class="p">.</span><span class="n">set_filename</span><span class="p">(</span><span class="n">fname</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">request</span><span class="p">.</span><span class="n">set_threshold</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">7</span><span class="p">]));</span>
        <span class="p">}</span>

        <span class="n">gazebo</span><span class="o">::</span><span class="n">transport</span><span class="o">::</span><span class="n">init</span><span class="p">();</span>
        <span class="n">gazebo</span><span class="o">::</span><span class="n">transport</span><span class="o">::</span><span class="n">run</span><span class="p">();</span>
        <span class="n">gazebo</span><span class="o">::</span><span class="n">transport</span><span class="o">::</span><span class="n">NodePtr</span> <span class="n">node</span><span class="p">(</span><span class="k">new</span> <span class="n">gazebo</span><span class="o">::</span><span class="n">transport</span><span class="o">::</span><span class="n">Node</span><span class="p">());</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">Init</span><span class="p">(</span><span class="s">&quot;default&quot;</span><span class="p">);</span>


        <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Request: </span><span class="se">\n</span><span class="s">&quot;</span>
                 <span class="s">&quot; origin.x: %f origin.y: %f</span><span class="se">\n</span><span class="s">&quot;</span>
                 <span class="s">&quot; map_width: %f map_height: %f</span><span class="se">\n</span><span class="s">&quot;</span>
                 <span class="s">&quot; Height: %f</span><span class="se">\n</span><span class="s"> Resolution: %f</span><span class="se">\n</span><span class="s"> Filename: %s</span><span class="se">\n</span><span class="s"> Threshold: %d&quot;</span><span class="p">,</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">origin</span><span class="p">().</span><span class="n">x</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">origin</span><span class="p">().</span><span class="n">y</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">map_width</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">map_height</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">height</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">resolution</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">filename</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span>
                 <span class="n">request</span><span class="p">.</span><span class="n">threshold</span><span class="p">());</span>

        <span class="n">gazebo</span><span class="o">::</span><span class="n">transport</span><span class="o">::</span><span class="n">PublisherPtr</span> <span class="n">imagePub</span> <span class="o">=</span>
                <span class="n">node</span><span class="o">-&gt;</span><span class="n">Advertise</span><span class="o">&lt;</span><span class="n">dronedoc</span><span class="o">::</span><span class="n">msgs</span><span class="o">::</span><span class="n">MapRequest</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;~/collision_map/command&quot;</span><span class="p">);</span>
        <span class="n">imagePub</span><span class="o">-&gt;</span><span class="n">WaitForConnection</span><span class="p">();</span>
        <span class="n">imagePub</span><span class="o">-&gt;</span><span class="n">Publish</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>

        <span class="n">gazebo</span><span class="o">::</span><span class="n">transport</span><span class="o">::</span><span class="n">fini</span><span class="p">();</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Usage: &quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;rosrun dronedoc request_publisher a1 a2 a3 a4 a5 [a6 a7]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a1: height</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a2: resolution</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a3: </span><span class="se">\&quot;</span><span class="s">(origin.x, origin.y)</span><span class="se">\&quot;\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">  Origin is the point on lower left corner of map image</span><span class="se">\n</span><span class="s">&quot;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a4: map_width</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a5: map_height</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a6: filename</span><span class="se">\t</span><span class="s">[default=</span><span class="se">\&quot;</span><span class="s">map</span><span class="se">\&quot;</span><span class="s">]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span>
                 <span class="s">&quot;</span><span class="se">\t</span><span class="s">a7: threshold</span><span class="se">\t</span><span class="s">[default=255]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id1">
<h2>使用法<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>プラグインを埋め込んだワールドを起動した状態で、次のようにノードを実行することでマップを作成できます。
以下のコマンドは一例です。引数無しで実行すれば使用法が表示されるので参考にしてください。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosrun dronedoc request_publisher <span class="m">10</span> <span class="m">0</span>.01 <span class="s2">&quot;(-12,0)&quot;</span> <span class="m">60</span> <span class="m">50</span> ~/map.png <span class="m">255</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>参考<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><a class="reference external" href="http://gazebosim.org/tutorials?cat=install&amp;tut=custom_messages&amp;ver=1.9-7">Custom messages</a></dt><dd><p>カスタムメッセージを使ってコリジョンマップを作る</p>
</dd>
<dt><a class="reference external" href="http://gazebosim.org/tutorials?tut=ros_plugins">ROS Plugin</a></dt><dd><p>ROS用のGazeboプラグインを作る</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Takaki Ueno.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>