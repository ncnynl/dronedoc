

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>PX4 SITLシミュレーション &mdash; Dronedoc 1.0.0 ドキュメント</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://uenota.github.io/dronedoc/px4sim/px4sim.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="自作ノードを実行する（C++）" href="../runnode/runnodecpp.html" />
    <link rel="prev" title="PX4 SITL Tutorial" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Dronedoc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">SLAM</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">PX4 SITLシミュレーション</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runnode/runnodecpp.html">自作ノードを実行する（C++）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runnode/runnodepy.html">自作ノードを実行する（Python）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addmodel/addmodel.html">新しいモデルを追加する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/slam.html">自律飛行とSLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/gps_nav.html">GPSを用いた自律飛行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/turtle_mapping.html">Turtlebotを使ってマップを作る</a></li>
<li class="toctree-l1"><a class="reference internal" href="../teleop/teleop.html">ゲームパッドを使ってドローンを操作する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/lidar_localization.html">LiDARとAMCLを用いた自己位置推定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/localization_and_mapping.html">LiDARを用いたSLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slam/lidar_nav.html">LiDARを用いた自律移動</a></li>
</ul>
<p class="caption"><span class="caption-text">Mapping</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../octomap/octomap.html">Octomapを使って3Dマップを作る</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_map_gmapping/build_map_gmapping.html">Gmappingを使って地図を生成する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_map_gazebo_plugin/build_map_gazebo_plugin.html">Gazebo Pluginを使って地図を作成する</a></li>
</ul>
<p class="caption"><span class="caption-text">Motion Planning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moveit/index.html">MoveIt!を使ってドローンの経路計画を行う</a></li>
<li class="toctree-l1"><a class="reference internal" href="../local_planner_for_uav/local_planner_for_uav.html">UAV用のローカルプランナを実装する</a></li>
</ul>
<p class="caption"><span class="caption-text">Tips</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qgc_intro/qgc_intro.html">QGroundControl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add_range_sensor/add_range_sensor.html">ドローンに距離センサを搭載する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filter_lidar/filter_lidar.html">LiDARのデータをフィルタリングする</a></li>
<li class="toctree-l1"><a class="reference internal" href="../change_local_planner/change_local_planner.html">move_baseのローカルプランナーを変更する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../airsim/airsim.html">AirSimシミュレータを使う</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/bash_commands/bash_commands.html">基本的なBashの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/ros/ros.html">ROSの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/terms/terms.html">用語集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/archive/archive.html">読書案内</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/trouble_shooting/index.html">トラブルシューティング</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dronedoc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>PX4 SITLシミュレーション</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/px4sim/px4sim.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="px4-sitl">
<h1>PX4 SITLシミュレーション<a class="headerlink" href="#px4-sitl" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="px4">
<h2>PX4とは<a class="headerlink" href="#px4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>PX4はドローンのフライトコントローラやファームウェアを開発しているオープンソースプロジェクトです。</p>
</div>
<div class="section" id="id1">
<h2>環境構築<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の内容は <a class="reference external" href="https://dev.px4.io/v1.8.0/en/setup/dev_env_linux.html">Development Environment on Linux - PX4 Developer Guide</a> を参考にしています。
問題が起きた場合は最新版を確認するようにしてください。</p>
<div class="section" id="id2">
<h3>事前準備<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>シリアルデバイスとの通信を行えるようにするためには、ユーザを <code class="docutils literal notranslate"><span class="pre">dialout</span></code> グループのメンバーにする必要があります。
ユーザを <code class="docutils literal notranslate"><span class="pre">dialout</span></code> のメンバーにするには以下のコマンドを実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo usermod -a -G dialout <span class="nv">$USER</span>
</pre></div>
</div>
<p>コマンドを実行したら、設定を有効にするために一旦ログアウトしてから再度ログインします。</p>
</div>
<div class="section" id="id3">
<h3>インストール<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>シミュレーション環境はスクリプトを使うことで簡単に構築できます。
はじめに、 <a class="reference external" href="https://raw.githubusercontent.com/PX4/Devguide/v1.8.0/build_scripts/ubuntu_sim_ros_gazebo.sh">ubuntu_sim_ros_gazebo.sh</a> をダウンロードします。</p>
<p>ダウンロードしたままの状態だとリポジトリキーが違っていてROSパッケージをインストールできないので、 <code class="docutils literal notranslate"><span class="pre">ubuntu_sim_ros_gazebo.sh</span></code> の以下の部分を変更します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
</pre></div>
</div>
<p>以下が正しいリポジトリキーを設定するコマンドです。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-key adv --keyserver <span class="s1">&#39;hkp://ha.pool.sks-keyservers.net:80&#39;</span> --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ubuntu_sim_ros_gazebo.sh</span></code> のあるディレクトリで以下のコマンドを実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ubuntu_sim_ros_gazebo.sh
</pre></div>
</div>
<p>コマンドを実行すれば自動でインストールされます。
ROSがインストールされていない場合は、ROSもインストールされるのでしばらく時間がかかります。</p>
<p>デフォルトのGazeboのバージョンは7.4よりも下なので、 <a class="reference external" href="http://gazebosim.org/tutorials?tut=install_ubuntu#Alternativeinstallation:step-by-step">Install Gazebo using Ubuntu packages</a> を参考にしてGazeboのインストールを行います。
初めにインストールされているGazeboをアンインストールします。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt purge gazebo* libgazebo*
</pre></div>
</div>
<p>次に <code class="docutils literal notranslate"><span class="pre">packages.osrfoundation.org</span></code> からパッケージをインストールできるように設定します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo sh -c <span class="s1">&#39;echo &quot;deb http://packages.osrfoundation.org/gazebo/ubuntu-stable `lsb_release -cs` main&quot; &gt; /etc/apt/sources.list.d/gazebo-stable.list&#39;</span>
</pre></div>
</div>
<p>次にリポジトリの鍵の設定を行います。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://packages.osrfoundation.org/gazebo.key -O - <span class="p">|</span> sudo apt-key add -
</pre></div>
</div>
<p>最後にGazebo7をインストールします。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt update
sudo apt install gazebo7
sudo apt install libgazebo7-dev
</pre></div>
</div>
<p>スクリプトの実行が終了したら、PX4のファームウェアが <code class="docutils literal notranslate"><span class="pre">~/src/Firmware</span></code> 以下に作成されています。</p>
</div>
</div>
<div class="section" id="gazebo">
<span id="gazebo-sim"></span><h2>Gazeboシミュレーション<a class="headerlink" href="#gazebo" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Gazeboを使ってシミュレーションを行うには、 <code class="docutils literal notranslate"><span class="pre">~/src/Firmware</span></code> 以下で次のコマンドを実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make posix_sitl_default gazebo
</pre></div>
</div>
<p>初回実行の場合はしばらく時間がかかります。
ビルドが終わったらシミュレーションが起動し、以下のような画面が表示されます。
（ドローンは赤枠内）</p>
<img alt="../_images/gazebosim1.png" src="../_images/gazebosim1.png" />
<p>他にも様々な機体のシミュレーションを行うことができます。
興味があれば <a class="reference external" href="https://dev.px4.io/v1.8.0/en/simulation/gazebo.html#quadrotor">シミュレーションで使える機体一覧</a> を参考にしてください。</p>
<p>シミュレータのターミナル内で以下のコマンドを実行すれば機体を離陸させることができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>commander takeoff
</pre></div>
</div>
<img alt="../_images/commander.png" src="../_images/commander.png" />
<p>他にもコマンドがあるので試してみるとよいでしょう。
<code class="docutils literal notranslate"><span class="pre">help</span></code> コマンドを実行すれば実行可能なコマンドの一覧を表示できます。</p>
</div>
<div class="section" id="rosgazebo">
<h2>ROSを使ってGazeboシミュレーションを行う<a class="headerlink" href="#rosgazebo" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="mavros">
<h3>mavros<a class="headerlink" href="#mavros" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ROSノードからシミュレータ内の機体に命令を送ったり、データを受信したりするには、<a class="reference external" href="http://wiki.ros.org/mavros">mavros</a> というROSパッケージを使います。</p>
<p>機体は <a class="reference external" href="https://mavlink.io/en/">Mavlink</a> というプロトコルに従って通信をしており、以下のようにmavros（MavlinkのROSラッパー）を経由してROSノードとの情報のやり取りをします。
センサ情報や速度指令などはトピックを通じてやりとりでき、他にも離着陸用のサービスが用意されています。
利用可能なサービスやトピックの一覧は <a class="reference external" href="http://wiki.ros.org/mavros#Plugins">ここ</a> にあります。</p>
<img alt="../_images/gazebo_mavros.png" src="../_images/gazebo_mavros.png" />
</div>
<div class="section" id="id7">
<h3>mavrosを使って機体と通信する<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>実際にmavrosを使って機体と通信してみましょう。
シミュレータの起動は <a class="reference internal" href="#gazebo-sim"><span class="std std-ref">Gazeboシミュレーション</span></a> で説明したとおりです。</p>
<p>シミュレータを起動したら、以下のコマンドでmavrosを起動します。
fcu_urlパラメータについては、 <a class="reference internal" href="#fcu-url"><span class="std std-ref">補足: mavrosのfcu_url引数について</span></a> で解説しています。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch mavros px4.launch fcu_url:<span class="o">=</span><span class="s2">&quot;udp://:14540@127.0.0.1:14557&quot;</span>
</pre></div>
</div>
<p>起動できたら別のターミナル内で、</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rostopic list
</pre></div>
</div>
<p>を実行してみましょう。 <code class="docutils literal notranslate"><span class="pre">/mavros/...</span></code> のようなトピックが現れていれば通信が出来ています。</p>
<p>試しにサービスを使ってみましょう。
<code class="docutils literal notranslate"><span class="pre">/mavros/cmd/arming</span></code> サービスに対して、メッセージ&quot;value: true&quot;を送信することでドローンのモータを起動することができます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosservice call /mavros/cmd/arming <span class="s2">&quot;value: true&quot;</span>
</pre></div>
</div>
<p>他にも離陸用のサービスなどがあるので試してみると良いでしょう。
<code class="docutils literal notranslate"><span class="pre">/mavros</span></code> まで入力してタブを2回入力すると使えるサービスの一覧が表示されます。
この機能はタブ補完といい、ROSコマンドだけでなく、Ubuntuのターミナル上でも使えます。（ <code class="docutils literal notranslate"><span class="pre">cd</span></code> コマンドで移動するときなど）
便利なので覚えておくといいかもしれません。</p>
<p>また、サービス名を入力し終わったあとにタブ補完を使うと必要なメッセージが自動で入力されます。
メッセージのそれぞれの値はデフォルト値が入力されているので必要な値に変えましょう。
上記のコマンドでモータを起動したあとに以下のコマンドを実行すればドローンを5m上空へ離陸させることができます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosservice call /mavros/cmd/takeoff <span class="s2">&quot;{min_pitch: 0.0, yaw: 0.0, latitude: 47.3977506, longitude: 8.5456074, altitude: 5}&quot;</span>
</pre></div>
</div>
<img alt="../_images/service_takeoff.png" src="../_images/service_takeoff.png" />
<p>latitude、longitude、altitudeはそれぞれ緯度、経度、高度のことで、ホームポジション（初期位置）ではそれぞれ、47.3977506、8.5456074、0です。
このコマンドでは、緯度47.3977506、経度8.5456074、高度5へ離陸しろ、というリクエストを送信することで指定の位置に離陸させています。</p>
</div>
<div class="section" id="ros">
<h3>シミュレータのROSラッパーを使う<a class="headerlink" href="#ros" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>PX4 SITLシミュレータは <code class="docutils literal notranslate"><span class="pre">roslaunch</span></code> コマンドを使って起動することもできます。
以下のlaunchファイルを使ってシミュレータを起動できます。</p>
<dl class="simple">
<dt>posix_sitl.launch</dt><dd><p>SITLシミュレーション環境を起動する</p>
</dd>
<dt>mavros_posix_sitl.launch</dt><dd><p>SITLとmavrosを起動する</p>
</dd>
</dl>
<p>この場合は次のようにシミュレータ、mavros、ROSノードが通信しています。</p>
<img alt="../_images/rossim.png" src="../_images/rossim.png" />
<div class="section" id="id8">
<h4>事前準備<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>これらのlaunchファイルからシミュレータを起動するには、ROSの環境変数の設定が必要です。
はじめに <code class="docutils literal notranslate"><span class="pre">~/src/Firmware</span></code> ディレクトリに移動します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/src/Firmware
</pre></div>
</div>
<p><a class="reference internal" href="#gazebo-sim"><span class="std std-ref">Gazeboシミュレーション</span></a> の内容を実行していない場合は次のコマンドを実行してください。
これによってシミュレーションに必要なファイルが作成されます。
以下のコマンドはすべて <code class="docutils literal notranslate"><span class="pre">~/src/Firmware</span></code> ディレクトリで実行する必要があります。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make posix_sitl_default gazebo
</pre></div>
</div>
<p>次に、必要な設定スクリプトを実行します。
ROSの設定ができている場合は一行目は実行しなくても構いません。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/catkin_ws/devel/setup.bash
<span class="nb">source</span> Tools/setup_gazebo.bash <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/build/posix_sitl_default
</pre></div>
</div>
<p>次に、環境変数を設定します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:<span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nb">export</span> <span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:<span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/Tools/sitl_gazebo
</pre></div>
</div>
<p>これらのコマンドは毎回実行しなければなりません。
面倒な場合は <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> に以下の内容を書き込んでおくと、毎回この内容が設定されます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> <span class="nv">$HOME</span>/src/Firmware/Tools/setup_gazebo.bash <span class="nv">$HOME</span>/src/Firmware <span class="nv">$HOME</span>/src/Firmware/build/posix_sitl_default &gt; /dev/null
<span class="nb">export</span> <span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:<span class="nv">$HOME</span>/src/Firmware
<span class="nb">export</span> <span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:<span class="nv">$HOME</span>/src/Firmware/Tools/sitl_gazebo
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>シミュレータを起動する<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下のコマンドを実行すればシミュレータが起動します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch px4 posix_sitl.launch
</pre></div>
</div>
<p>mavrosも同時に起動したい場合には <code class="docutils literal notranslate"><span class="pre">mavros_posix_sitl.launch</span></code> を使います。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch px4 mavros_posix_sitl.launch
</pre></div>
</div>
<p>また、以下のようにすれば <a class="reference external" href="https://dev.px4.io/v1.8.0/en/simulation/gazebo.html">Gazebo Simulation - PX4 Developer Guide</a> にリストアップされている機体を使用することもできます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch px4 mavros_posix_sitl.launch vehicle:<span class="o">=</span>vehicle_name
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mavrosfcu-url">
<span id="fcu-url"></span><h2>補足: mavrosのfcu_url引数について<a class="headerlink" href="#mavrosfcu-url" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="roslaunch">
<h3>roslaunchコマンドの説明<a class="headerlink" href="#roslaunch" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ROSでは、以下の形式を使うことでlaunchファイル内の変数に値を設定することができます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch package file.launch arg:<span class="o">=</span>value
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">px4.launch</span></code> ファイルの内容は以下のようになっており、 <code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">mavros</span> <span class="pre">px4.launch</span> <span class="pre">fcu_url:=&quot;udp://:14540&#64;127.0.0.1:14557&quot;</span></code> とすることで <code class="docutils literal notranslate"><span class="pre">fcu_url</span></code> 引数の内容を変更することができます。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
<span class="c">&lt;!-- vim: set ft=xml noet : --&gt;</span>
<span class="c">&lt;!-- example launch script for PX4 based FCU&#39;s --&gt;</span>

<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;fcu_url&quot;</span> <span class="na">default=</span><span class="s">&quot;/dev/ttyACM0:57600&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;gcs_url&quot;</span> <span class="na">default=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;tgt_system&quot;</span> <span class="na">default=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;tgt_component&quot;</span> <span class="na">default=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;log_output&quot;</span> <span class="na">default=</span><span class="s">&quot;screen&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;fcu_protocol&quot;</span> <span class="na">default=</span><span class="s">&quot;v2.0&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;respawn_mavros&quot;</span> <span class="na">default=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;$(find mavros)/launch/node.launch&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;pluginlists_yaml&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find mavros)/launch/px4_pluginlists.yaml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;config_yaml&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find mavros)/launch/px4_config.yaml&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;fcu_url&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg fcu_url)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;gcs_url&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg gcs_url)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;tgt_system&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg tgt_system)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;tgt_component&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg tgt_component)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;log_output&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg log_output)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;fcu_protocol&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg fcu_protocol)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;respawn_mavros&quot;</span> <span class="na">default=</span><span class="s">&quot;$(arg respawn_mavros)&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/include&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>fcu_urlについて<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">fcu_url</span></code> はフライトコントローラ（FCU）のアドレスです。
シリアル（USBなど）で接続している場合は <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM0</span></code> （環境によって異なる）にFCUが接続されているので、これを指定します。
コロンの後ろの数字はボーレート（baudrate）です。</p>
<p>シミュレーションの場合はUDPを使って通信します。
UDPを使って通信する場合は次のような形式に従ってfcu_urlを指定します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>udp://[bind_host][:port]@[remote_host][:port]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bind_host</span></code> はFCUのIPアドレスを指定します。デフォルトでは <code class="docutils literal notranslate"><span class="pre">INADDR_ANY(0.0.0.0)</span></code> となっており、mavrosはすべてのIPアドレスからのデータを受信します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code> はROS側の待受ポートで、デフォルトでは <code class="docutils literal notranslate"><span class="pre">14540</span></code> です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remote_host</span></code> はリモートのPCのIPアドレスです。シミュレーションの場合は <code class="docutils literal notranslate"><span class="pre">localhost</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> を指定します。</p></li>
<li><p>次にある <code class="docutils literal notranslate"><span class="pre">port</span></code> はFCU側の待受ポート（ <code class="docutils literal notranslate"><span class="pre">14557</span></code> ）を指定します。</p></li>
</ul>
<p>それぞれの部分に数値を当てはめると <code class="docutils literal notranslate"><span class="pre">fcu_url</span></code> は次のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>udp://:14540@127.0.0.1:14557
</pre></div>
</div>
<p>ポートの設定については <a class="reference external" href="https://dev.px4.io/v1.8.0/en/simulation/ros_interface.html">ROS with Gazebo Simulation - PX4 Developer Guide</a> を、 <code class="docutils literal notranslate"><span class="pre">fcu_url</span></code> の詳細については <a class="reference external" href="http://wiki.ros.org/mavros#Connection_URL">mavros - ROS Wiki</a> を参考にしてください。</p>
</div>
</div>
<div class="section" id="id11">
<h2>参考<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="simple">
<dt><a class="reference external" href="https://dev.px4.io/v1.8.0/en/">PX4 Developer Guide</a></dt><dd><p>PX4開発者Wiki。基本的な内容はここにあります</p>
</dd>
<dt><a class="reference external" href="https://dev.px4.io/v1.8.0/en/setup/dev_env_linux.html">Development Environment on Linux - PX4 Developer Guide</a></dt><dd><p>Linux向けPX4ファームウェアインストールガイド</p>
</dd>
<dt><a class="reference external" href="https://dev.px4.io/v1.8.0/en/simulation/gazebo.html">Gazebo Simulation - PX4 Developer Guide</a></dt><dd><p>Gazeboを使ってシミュレーションを行う</p>
</dd>
<dt><a class="reference external" href="https://dev.px4.io/v1.8.0/en/simulation/ros_interface.html">ROS with Gazebo Simulation</a></dt><dd><p>ROSとGazeboを使ってシミュレーションを行う</p>
</dd>
<dt><a class="reference external" href="https://manual.atmark-techno.com/armadillo-guide/armadillo-guide-2_ja-2.1.0/ch03.html#sec_terminal">Linuxシステムの仕組みと運用、管理</a></dt><dd><p>シリアル端末について</p>
</dd>
<dt><a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/UnderstandingServicesParams#Using_rosparam">Understanding ROS Services and Parameters</a></dt><dd><p>ROSサービスについて</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../runnode/runnodecpp.html" class="btn btn-neutral float-right" title="自作ノードを実行する（C++）" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../index.html" class="btn btn-neutral float-left" title="PX4 SITL Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Takaki Ueno.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>